CREATE OR REPLACE PACKAGE PKG_SIGCATMIN is
TYPE REFCUR_TYPE IS REF CURSOR;

PROCEDURE P_SEL_DATOS_CARTA(V_CAMPO   IN VARCHAR2,
                            V_DATO   IN VARCHAR2,
                            VO_CURSOR OUT REFCUR_TYPE);
PROCEDURE P_SEL_DM_UNIQUE(V_CODIGO  IN VARCHAR2,
                          V_TIPO    IN VARCHAR2,
                          VO_CURSOR OUT REFCUR_TYPE);
PROCEDURE P_SEL_DATOS_DM(V_CODIGO  IN VARCHAR2,
                          VO_CURSOR OUT REFCUR_TYPE);                          
                            
END PKG_SIGCATMIN;



-*******************************************************

CREATE OR REPLACE PACKAGE BODY PKG_SIGCATMIN IS

PROCEDURE P_SEL_DATOS_CARTA(V_CAMPO   IN VARCHAR2,
                            V_DATO   IN VARCHAR2,
                            VO_CURSOR OUT REFCUR_TYPE) IS
  V_OPCION VARCHAR2(12);
  V_SQL    VARCHAR(4000);

BEGIN
  IF V_CAMPO = 'CODIGO' THEN
    V_OPCION := 'A.CA_CODCAR';
  ELSIF V_CAMPO = 'NOMBRE' THEN
    V_OPCION := 'A.CA_NOMDES';
  END IF;

  --  OPEN VO_CURSOR FOR
  V_SQL := 'SELECT A.CA_CODCAR CODIGO,
         A.CA_NOMDES NOMBRE,
         A.CA_ZONA ZONA,
         A.CA_ESTMIN / 1000 XMIN,
         A.CA_NORMIN / 1000 YMIN,
         A.CA_ESTMAX / 1000 XMAX,
         A.CA_NORMAX / 1000 YMAX
    FROM SISGEM.SG_M_CARTAS A
   WHERE ' || V_OPCION || ' = ''' || V_DATO;
  V_SQL := V_SQL || CHR(39);
  OPEN VO_CURSOR For V_SQL;
END P_SEL_DATOS_CARTA;
  


PROCEDURE P_SEL_DM_UNIQUE(V_CODIGO  IN VARCHAR2,
                          V_TIPO    IN VARCHAR2,
                          VO_CURSOR OUT REFCUR_TYPE) IS

BEGIN
  IF V_TIPO = 1 THEN
    OPEN VO_CURSOR FOR
      SELECT DISTINCT A.CG_CODIGO CODIGO,
                      A.PE_NOMDER NOMBRE,
                      A.CA_CODCAR CARTA,
                      A.PE_ZONCAT ZONA,
                      A.TE_TIPOEX TIPO,
                      A.PE_METALI NATURALEZA,
                      PACK_DBA_SG_D_HECTAEXPEDIENTE.HECTA(A.CG_CODIGO, '01') HECTAREA,
                      A.EE_ESTAEX ESTADO
        FROM SG_D_PETITORIOS A, SC_V_COORDENADADET B
       WHERE A.CG_CODIGO = B.CG_CODIGO
         AND A.CG_CODIGO = V_CODIGO;
  ELSIF V_TIPO = 2 THEN
    OPEN VO_CURSOR FOR
      SELECT DISTINCT A.CG_CODIGO CODIGO,
                      A.PE_NOMDER NOMBRE,
                      A.CA_CODCAR CARTA,
                      A.PE_ZONCAT ZONA,
                      A.TE_TIPOEX TIPO,
                      A.PE_METALI NATURALEZA,
                      PACK_DBA_SG_D_HECTAEXPEDIENTE.HECTA(A.CG_CODIGO, '01') HECTAREA,
                      A.EE_ESTAEX ESTADO
        FROM SG_D_PETITORIOS A, SC_V_COORDENADADET B
       WHERE A.CG_CODIGO = B.CG_CODIGO
         AND A.PE_NOMDER = V_CODIGO;
  END IF;

EXCEPTION
  WHEN OTHERS THEN
    NULL;
END;


PROCEDURE P_SEL_DATOS_DM(V_CODIGO  IN VARCHAR2,
                          VO_CURSOR OUT REFCUR_TYPE) IS
BEGIN
    OPEN VO_CURSOR FOR
SELECT  A.CG_CODIGO CG_CODIGO, A.PE_NOMDER PE_NOMDER, PACK_DBA_SG_D_PERTITULAR.ULT_VIGENTE(A.CG_CODIGO) TITULAR, A.CA_CODCAR CA_CODCAR, A.PE_ZONCAT PE_ZONCAT, A.TE_TIPOEX TE_TIPOEX, A.PE_METALI NATURALEZA, 
       PACK_DBA_SG_D_HECTAEXPEDIENTE.HECTA(A.CG_CODIGO, '01') HECTAREA, A.EE_ESTAEX ESTADO,A.PE_VIGCAT,B.CD_CORNOR,B.CD_COREST
FROM SG_D_PETITORIOS A, SC_V_COORDENADADET B
WHERE  A.CG_CODIGO = B.CG_CODIGO AND A.CG_CODIGO = V_CODIGO;
END P_SEL_DATOS_DM;


BEGIN
  EXECUTE IMMEDIATE 'ALTER SESSION SET NLS_LANGUAGE = SPANISH NLS_TERRITORY = SPAIN';
  --   ALTER SESSION SET NLS_LANG = SPANISH_SPAIN.WE8MSWIN1252;
END PKG_SIGCATMIN;

