{\rtf1\ansi\ansicpg1252\deff0\deflang3082{\fonttbl{\f0\fnil Courier New;}{\f1\fnil\fcharset0 Courier New;}{\f2\fswiss\fcharset0 Arial;}}
{\colortbl ;\red0\green0\blue0;\red0\green0\blue240;\red255\green0\blue0;}
{\*\generator Msftedit 5.41.15.1507;}\viewkind4\uc1\pard\cf1\b\f0\fs16\par
CREATE\b0  \b OR\b0  \b REPLACE\b0  \b PACKAGE\b0  PKG_SIGCATMIN \b is\b0\line\b TYPE\b0  REFCUR_TYPE \b IS\b0  \b REF\b0  \b CURSOR\b0 ;\line\line\b PROCEDURE\b0  P_SEL_DATOS_CARTA(V_CAMPO   \b IN\b0  \b VARCHAR2\b0 ,\line                             V_DATO   \b IN\b0  \b VARCHAR2\b0 ,\line                             VO_CURSOR \b OUT\b0  REFCUR_TYPE);\line\b PROCEDURE\b0  P_SEL_DM_UNIQUE(V_CODIGO  \b IN\b0  \b VARCHAR2\b0 ,\line                           V_TIPO    \b IN\b0  \b VARCHAR2\b0 ,\line                           VO_CURSOR \b OUT\b0  REFCUR_TYPE);\line\b PROCEDURE\b0  P_SEL_DATOS_DM(V_CODIGO  \b IN\b0  \b VARCHAR2\b0 ,\line                           VO_CURSOR \b OUT\b0  REFCUR_TYPE);                          \line\b PROCEDURE\b0  P_SEL_DATOS_UBIGEO(V_CODIGO \b IN\b0  \b VARCHAR2\b0 , VO_CURSOR \b OUT\b0  REFCUR_TYPE);       \line\b PROCEDURE\b0  P_VERIFICA_USUARIO(V_USUARIO \b IN\b0  \b VARCHAR2\b0 , VO_CURSOR \b OUT\b0  REFCUR_TYPE);\line\b PROCEDURE\b0  P_SEL_AREA_RESERVA(V_TIPO    \b IN\b0  \b VARCHAR2\b0 ,\line                              V_BUSCA   \b IN\b0  \b VARCHAR2\b0 ,\line                              VO_CURSOR \b OUT\b0  REFCUR_TYPE);\line\b PROCEDURE\b0  SP_VERIFICA_OBSERVACION(V_CG_CODIGO \b IN\b0  \b VARCHAR2\b0 ,\line                                   V_RETORNO   \b OUT\b0  \b VARCHAR2\b0 );\line                              \line\b PROCEDURE\b0  SP_INS_UPD_OBSERVACION(V_CG_CODIGO \b IN\b0  \b VARCHAR2\b0 ,\line                                  V_CG_CODEVA \b IN\b0  \b VARCHAR2\b0 ,\line                                  V_ET_INDICA \b IN\b0  \b VARCHAR2\b0 ,\line                                  V_ET_USUFOR \b IN\b0  \b VARCHAR2\b0 ,\line                                  V_US_LOGUSE \b IN\b0  \b VARCHAR2\b0 ,\line                                  V_OPCION    \b IN\b0  \b VARCHAR2\b0 ,\line                                  V_RETORNO   \b OUT\b0  \b VARCHAR2\b0 );\line        \line                             \line\b END\b0  PKG_SIGCATMIN;\line\b\f1\par
'********************************************************************************\f0\par
\par
CREATE\b0  \b OR\b0  \b REPLACE\b0  \b PACKAGE\b0  \b BODY\b0  PKG_SIGCATMIN \b IS\b0\line\line\b PROCEDURE\b0  P_SEL_DATOS_CARTA(V_CAMPO   \b IN\b0  \b VARCHAR2\b0 ,\line                             V_DATO   \b IN\b0  \b VARCHAR2\b0 ,\line                             VO_CURSOR \b OUT\b0  REFCUR_TYPE) \b IS\b0\line   V_OPCION \b VARCHAR2\b0 (\cf2 12\cf1 );\line   V_SQL    \b VARCHAR\b0 (\cf2 4000\cf1 );\line\line\b BEGIN\b0\line   \b IF\b0  V_CAMPO = \cf2 'CODIGO'\cf1  \b THEN\b0\line     V_OPCION := \cf2 'A.CA_CODCAR'\cf1 ;\line   \b ELSIF\b0  V_CAMPO = \cf2 'NOMBRE'\cf1  \b THEN\b0\line     V_OPCION := \cf2 'A.CA_NOMDES'\cf1 ;\line   \b END\b0  \b IF\b0 ;\line\line   \cf3\i --  OPEN VO_CURSOR FOR\cf1\i0\line   V_SQL := \cf2 'SELECT A.CA_CODCAR CODIGO,\line          A.CA_NOMDES NOMBRE,\line          A.CA_ZONA ZONA,\line          A.CA_ESTMIN / 1000 XMIN,\line          A.CA_NORMIN / 1000 YMIN,\line          A.CA_ESTMAX / 1000 XMAX,\line          A.CA_NORMAX / 1000 YMAX\line     FROM SG_M_CARTAS A\line    WHERE '\cf1  || V_OPCION || \cf2 ' LIKE '''\cf1  || V_DATO || \cf2 '%'''\cf1  || \cf2 ' AND A.CA_ESTMIN <> 0 '\cf1  ;\line  \cf3\i -- V_SQL := V_SQL || CHR(39);\cf1\i0\line   \b OPEN\b0  VO_CURSOR \b For\b0  V_SQL;\line\b END\b0  P_SEL_DATOS_CARTA;\line\line\line\b PROCEDURE\b0  P_SEL_DM_UNIQUE(V_CODIGO  \b IN\b0  \b VARCHAR2\b0 ,\line                           V_TIPO    \b IN\b0  \b VARCHAR2\b0 ,\line                           VO_CURSOR \b OUT\b0  REFCUR_TYPE) \b IS\b0\line\b BEGIN\b0\line   \b IF\b0  V_TIPO = \cf2 1\cf1  \b THEN\b0\line     \b OPEN\b0  VO_CURSOR \b FOR\b0\line       \b SELECT\b0  \b DISTINCT\b0  A.CG_CODIGO CODIGO,\line                       A.PE_NOMDER NOMBRE,\line                       A.CA_CODCAR CARTA,\line                       A.PE_ZONCAT ZONA,\line                       A.TE_TIPOEX TIPO,\line                       A.PE_METALI NATURALEZA,\line                       PACK_DBA_SG_D_HECTAEXPEDIENTE.HECTA(A.CG_CODIGO, \cf2 '01'\cf1 ) HECTAREA,\line                       A.EE_ESTAEX ESTADO\line         \b FROM\b0  SG_D_PETITORIOS A, SC_V_COORDENADADET B\line        \b WHERE\b0  A.CG_CODIGO = B.CG_CODIGO\line          \b AND\b0  A.CG_CODIGO \b LIKE\b0   V_CODIGO || \cf2 '%'\cf1 ;\line   \b ELSIF\b0  V_TIPO = \cf2 2\cf1  \b THEN\b0\line     \b OPEN\b0  VO_CURSOR \b FOR\b0\line       \b SELECT\b0  \b DISTINCT\b0  A.CG_CODIGO CODIGO,\line                       A.PE_NOMDER NOMBRE,\line                       A.CA_CODCAR CARTA,\line                       A.PE_ZONCAT ZONA,\line                       A.TE_TIPOEX TIPO,\line                       A.PE_METALI NATURALEZA,\line                       PACK_DBA_SG_D_HECTAEXPEDIENTE.HECTA(A.CG_CODIGO, \cf2 '01'\cf1 ) HECTAREA,\line                       A.EE_ESTAEX ESTADO\line         \b FROM\b0  SG_D_PETITORIOS A, SC_V_COORDENADADET B\line        \b WHERE\b0  A.CG_CODIGO = B.CG_CODIGO\line          \b AND\b0  A.PE_NOMDER \b LIKE\b0  V_CODIGO || \cf2 '%'\cf1 ;\line   \b END\b0  \b IF\b0 ;\line\line\b EXCEPTION\b0\line   \b WHEN\b0  \b OTHERS\b0  \b THEN\b0\line     \b NULL\b0 ;\line\b END\b0 ;\line\line\line\b PROCEDURE\b0  P_SEL_DATOS_DM(V_CODIGO \b IN\b0  \b VARCHAR2\b0 , VO_CURSOR \b OUT\b0  REFCUR_TYPE) \b IS\b0\line\b BEGIN\b0\line   \b OPEN\b0  VO_CURSOR \b FOR\b0\line     \b SELECT\b0  A.CG_CODIGO CG_CODIGO,\line            A.PE_NOMDER PE_NOMDER,\line            PACK_DBA_SG_D_PERTITULAR.ULT_VIGENTE(A.CG_CODIGO) TITULAR,\line            A.CA_CODCAR CA_CODCAR,\line            A.PE_ZONCAT PE_ZONCAT,\line            A.TE_TIPOEX TE_TIPOEX,\line            A.PE_METALI NATURALEZA,\line            PACK_DBA_SG_D_HECTAEXPEDIENTE.HECTA(A.CG_CODIGO, \cf2 '01'\cf1 ) HECTAREA,\line            A.EE_ESTAEX ESTADO,\line            A.PE_VIGCAT,\line            B.CD_CORNOR,\line            B.CD_COREST\line       \b FROM\b0  SG_D_PETITORIOS A, SC_V_COORDENADADET B\line      \b WHERE\b0  A.CG_CODIGO = B.CG_CODIGO\line        \b AND\b0  A.CG_CODIGO = V_CODIGO;\line\b END\b0  P_SEL_DATOS_DM;\line\line\b PROCEDURE\b0  P_SEL_DATOS_UBIGEO(V_CODIGO \b IN\b0  \b VARCHAR2\b0 , VO_CURSOR \b OUT\b0  REFCUR_TYPE) \b IS\b0\line\b BEGIN\b0\line   \b OPEN\b0  VO_CURSOR \b FOR\b0\line     \b SELECT\b0  DE_CODDEM, DE_DESDEP DPTO, DE_DESPRV PROV, DE_DESDIS DIST\line       \b FROM\b0  SG_M_DEMARCACION\line      \b WHERE\b0  DE_CODDEM = V_CODIGO;\line\b END\b0  P_SEL_DATOS_UBIGEO;\line\line\line\b PROCEDURE\b0  P_VERIFICA_USUARIO(V_USUARIO \b IN\b0  \b VARCHAR2\b0 ,\line                             VO_CURSOR \b OUT\b0  REFCUR_TYPE) \b IS\b0\line\b BEGIN\b0\line   \b OPEN\b0  VO_CURSOR \b FOR\b0\line     \b SELECT\b0  SGM.US_LOGUSE USUARIO, SGM.US_NOMUSE USERNAME\line       \b FROM\b0  SG_M_USUARIOS SGM\line      \b WHERE\b0  SGM.US_LOGUSE = V_USUARIO;\line        \b EXCEPTION\b0\line     \b WHEN\b0  \b OTHERS\b0  \b THEN\b0\line       \b NULL\b0 ;\line\b END\b0  P_VERIFICA_USUARIO;\line\line\b PROCEDURE\b0  P_SEL_AREA_RESERVA(V_TIPO    \b IN\b0  \b VARCHAR2\b0 ,\line                              V_BUSCA   \b IN\b0  \b VARCHAR2\b0 ,\line                             VO_CURSOR \b OUT\b0  REFCUR_TYPE) \b IS\b0\line\b BEGIN\b0\line   \b IF\b0  V_TIPO = \cf2 'CODIGO'\cf1  \b THEN\b0\line     \b OPEN\b0  VO_CURSOR \b FOR\b0\line        \b SELECT\b0  A.CG_CODIGO,\line              A.PE_NOMARE,\line              B.ZA_ZONA,\line              E.PA_DESCRI,\line              C.TN_DESTIP,\line              D.CA_DESCAT,\line              B.SE_SITUEX\line         \b FROM\b0  SC_D_AREANOMINERA  A,\line              SC_D_ZONASXANM     B,\line              SC_M_TIPONOMIN     C,\line              SC_M_CATEGORIA     D,\line              SC_M_TIPOPARTEAREA E,\line              SC_M_NORMALEGAL    F\line        \b WHERE\b0  B.CG_CODIGO = A.CG_CODIGO\line          \b AND\b0  A.TN_CODTIP = C.TN_CODTIP(+)\line          \b AND\b0  A.CA_CODCAT = D.CA_CODCAT(+)\line          \b AND\b0  B.PA_CODPAR = E.PA_CODPAR(+)\line          \b AND\b0  A.NL_CODNOR = F.NL_CODNOR(+)\line          \b AND\b0  B.CG_CODIGO = V_BUSCA \b ORDER\b0  \b BY\b0  A.PE_NOMARE;\line   \b ELSIF\b0  V_TIPO = \cf2 'NOMBRE'\cf1  \b THEN\b0\line     \b OPEN\b0  VO_CURSOR \b FOR\b0\line       \b SELECT\b0  A.CG_CODIGO,\line              A.PE_NOMARE,\line              B.ZA_ZONA,\line              E.PA_DESCRI,\line              C.TN_DESTIP,\line              D.CA_DESCAT,\line              B.SE_SITUEX\line         \b FROM\b0  SC_D_AREANOMINERA  A,\line              SC_D_ZONASXANM     B,\line              SC_M_TIPONOMIN     C,\line              SC_M_CATEGORIA     D,\line              SC_M_TIPOPARTEAREA E,\line              SC_M_NORMALEGAL    F\line        \b WHERE\b0  B.CG_CODIGO = A.CG_CODIGO\line          \b AND\b0  A.TN_CODTIP = C.TN_CODTIP(+)\line          \b AND\b0  A.CA_CODCAT = D.CA_CODCAT(+)\line          \b AND\b0  B.PA_CODPAR = E.PA_CODPAR(+)\line          \b AND\b0  A.NL_CODNOR = F.NL_CODNOR(+)\line          \b AND\b0  A.PE_NOMARE \b LIKE\b0  V_BUSCA || \cf2 '%'\cf1  \b ORDER\b0  \b BY\b0  A.PE_NOMARE;\line   \b END\b0  \b IF\b0 ;\line\b END\b0  P_SEL_AREA_RESERVA;\line\line\line\b PROCEDURE\b0  SP_VERIFICA_OBSERVACION(V_CG_CODIGO \b IN\b0  \b VARCHAR2\b0 ,\line                                   V_RETORNO   \b OUT\b0  \b VARCHAR2\b0 ) \b IS\b0\line   P_CODIGO_EXISTE \b INTEGER\b0 ;\line\b BEGIN\b0\line   P_CODIGO_EXISTE := \cf2 0\cf1 ;\line   V_RETORNO       := \cf2 '0'\cf1 ;\line   \b SELECT\b0  \b COUNT\b0 (*)\line     \b INTO\b0  P_CODIGO_EXISTE\line     \b FROM\b0  SG_T_EVALTECNICA\line    \b WHERE\b0  CG_CODIGO = V_CG_CODIGO;\line   \b IF\b0  P_CODIGO_EXISTE <> \cf2 0\cf1  \b THEN\b0\line     V_RETORNO := \cf2 '1'\cf1 ;\line   \b END\b0  \b IF\b0 ;\line\b END\b0  SP_VERIFICA_OBSERVACION;\line\line\b PROCEDURE\b0  SP_INS_UPD_OBSERVACION(V_CG_CODIGO \b IN\b0  \b VARCHAR2\b0 ,\line                                  V_CG_CODEVA \b IN\b0  \b VARCHAR2\b0 ,\line                                  V_ET_INDICA \b IN\b0  \b VARCHAR2\b0 ,\line                                  V_ET_USUFOR \b IN\b0  \b VARCHAR2\b0 ,\line                                  V_US_LOGUSE \b IN\b0  \b VARCHAR2\b0 ,\line                                  V_OPCION    \b IN\b0  \b VARCHAR2\b0 ,\line                                  V_RETORNO   \b OUT\b0  \b VARCHAR2\b0 ) \b IS\b0\line   V_VA_FACTOR         \b VARCHAR2\b0 (\cf2 255\cf1 );\line   V_VA_TXT_FACTOR     \b CLOB\b0 ;\line   V_NU_POS_FACTOR     \b NUMBER\b0 (\cf2 4\cf1 );\line   V_NU_POS_CAD_FACTOR \b NUMBER\b0 (\cf2 4\cf1 );\line   V_NU_ORDEN          \b NUMBER\b0 (\cf2 2\cf1 );\line   V_VA_Dato           \b varchar2\b0 (\cf2 100\cf1 );\line   V_DESCRIP           \b varchar2\b0 (\cf2 100\cf1 );\line\b BEGIN\b0\line   V_RETORNO := \cf2 '0'\cf1 ;\line   \line   \b IF\b0  V_OPCION = \cf2 'UPDATE'\cf1  \b THEN\b0\line     \b DELETE\b0  \b FROM\b0  SG_T_EVALTECNICA \b WHERE\b0  CG_CODIGO = V_CG_CODIGO;\line   \b END\b0  \b IF\b0 ;\line\line   V_VA_TXT_FACTOR := V_ET_INDICA;\line   V_NU_ORDEN      := \cf2 1\cf1 ;\line   \b LOOP\b0\line     V_DESCRIP := \cf2 ''\cf1 ;\line     V_VA_FACTOR         := \cf2 ''\cf1 ;\line     V_NU_POS_FACTOR     := INSTR(V_VA_TXT_FACTOR, \cf2 '|'\cf1 );\line     V_NU_POS_CAD_FACTOR := INSTR(V_VA_TXT_FACTOR, \cf2 '||'\cf1 );\line     \b IF\b0  (V_NU_POS_FACTOR = \cf2 0\cf1  \b OR\b0  V_NU_POS_FACTOR \b IS\b0  \b NULL\b0 ) \b THEN\b0\line       \b EXIT\b0 ;\line     \b END\b0  \b IF\b0 ;\line     V_VA_FACTOR := \b TRIM\b0 (substr(V_VA_TXT_FACTOR, \cf2 1\cf1 , V_NU_POS_FACTOR - \cf2 1\cf1 ));\line     V_VA_Dato   := \b TRIM\b0 (SUBSTR(V_VA_TXT_FACTOR, V_NU_POS_FACTOR + \cf2 1\cf1 , V_NU_POS_CAD_FACTOR - V_NU_POS_FACTOR - \cf2 1\cf1 ));\line\line\cf3\i --    BEGIN\cf1\i0\line\cf3\i --IF SUBSTR(V_VA_Dato,1,11) <> 'Area Urbana' THEN\cf1\i0\line\b SELECT\b0  IE_DESIND \b INTO\b0  V_DESCRIP \b FROM\b0  SG_M_INDEVALTEC \b WHERE\b0  IE_INDICA = V_VA_Dato;\line\cf3\i --- ELSE\cf1\i0\line\cf3\i -- V_DESCRIP:=V_VA_Dato;\cf1\i0\line\cf3\i --END IF;\cf1\i0\line\cf3\i --    EXCEPTION\cf1\i0\line\cf3\i --      WHEN OTHERS THEN\cf1\i0\line\cf3\i --    V_DESCRIP:=V_VA_Dato;\cf1\i0\line\cf3\i --    END;\cf1\i0\line     \line     \b IF\b0  \b TRIM\b0 (V_VA_TXT_FACTOR) \b IS\b0  \b NOT\b0  \b NULL\b0  \b THEN\b0\line       \b INSERT\b0  \b INTO\b0  SG_T_EVALTECNICA\line         (CG_CODIGO,\line          CG_CODEVA,\line          ET_INDICA,\line          ET_SESION,\line          ET_DESCRI,\line          ET_FORMAT,\line          ET_USUFOR,\line          US_LOGUSE,\line          ET_FECING)\line       \b VALUES\b0\line         (V_CG_CODIGO,\line          V_CG_CODEVA,\line          V_VA_Dato,\line          \cf2 '1111111'\cf1 ,\line          INITCAP(V_DESCRIP),\line          \cf2 'OB'\cf1 ,\line          V_ET_USUFOR,\line          V_US_LOGUSE,\line          \b SYSDATE\b0 );\line     \b END\b0  \b IF\b0 ;\line     V_VA_TXT_FACTOR := SUBSTR(V_VA_TXT_FACTOR, V_NU_POS_CAD_FACTOR + \cf2 2\cf1 );\line     V_NU_ORDEN      := V_NU_ORDEN + \cf2 1\cf1 ;\line   \b END\b0  \b LOOP\b0 ;\line\line   \cf3\i /*\line   INSERT INTO SG_T_EVALTECNICA\line     (CG_CODIGO,\line      CG_CODEVA,\line      ET_INDICA,\line      ET_SESION,\line      ET_DESCRI,\line      ET_FORMAT,\line      ET_USUFOR,\line      US_LOGUSE,\line      ET_FECING)\line   VALUES\line     (V_CG_CODIGO,\line      V_CG_CODEVA,\line      V_ET_INDICA,\line      '1111111',\line      'Descripcion',\line      'OB',\line      V_ET_USUFOR,\line      V_US_LOGUSE,\line      sysdate);\line   V_RETORNO := '1';\line   --  ELSIF V_OPCION = 'UPDATE' THEN\line   UPDATE SG_T_EVALTECNICA\line      SET CG_CODIGO = V_CG_CODIGO,\line          CG_CODEVA = V_CG_CODEVA,\line          ET_INDICA = V_ET_INDICA,\line          ET_SESION = '1111111',\line          ET_DESCRI = 'Descripcion',\line          ET_FORMAT = 'OB',\line          ET_USUFOR = V_ET_USUFOR,\line          US_LOGUSE = V_US_LOGUSE,\line          ET_FECING = sysdate\line    WHERE CG_CODIGO = V_CG_CODIGO;*/\cf1\i0\line   V_RETORNO := \cf2 '1'\cf1 ;\line   \cf3\i --  END IF;\cf1\i0\line   \b COMMIT\b0 ;\line\line\b EXCEPTION\b0\line   \b WHEN\b0  \b OTHERS\b0  \b THEN\b0\line     \b ROLLBACK\b0 ;\line     RAISE_APPLICATION_ERROR(-\cf2 20000\cf1 , \b SQLCODE\b0  || \cf2 ' '\cf1  || \b SQLERRM\b0 );\line\b END\b0  SP_INS_UPD_OBSERVACION;\line\line\b BEGIN\b0\line   \b EXECUTE\b0  \b IMMEDIATE\b0  \cf2 'ALTER SESSION SET NLS_LANGUAGE = SPANISH NLS_TERRITORY = SPAIN'\cf1 ;\line   \cf3\i --   ALTER SESSION SET NLS_LANG = SPANISH_SPAIN.WE8MSWIN1252;\cf1\i0\line\b END\b0  PKG_SIGCATMIN;\line\line\cf0\f2\fs20\par
}
 